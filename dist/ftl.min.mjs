function t(e,r,n,a){var o=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(o,t.prototype),o.expected=r,o.found=n,o.location=a,o.name="SyntaxError",o}function e(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}function r(e,r){var n,a,o,u,l={},i=(r=void 0!==r?r:{}).grammarSource,c={Root:dt},s=dt,h=":",d="?.",f=",",p="true",v="false",A=/^[0-9]/,m=/^[^']/,g=/^[^"]/,b=/^[a-zA-Z$_]/,T=/^[a-zA-Z$_0-9_]/,y=/^[ \t\n\r]/,C=ut("?",!1),x=ut(":",!1),E=ut("?.",!1),N=ut(".",!1),F=it("subscript"),w=ut("[",!1),O=ut("]",!1),S=it("methodCall"),L=ut("(",!1),_=ut(",",!1),H=ut(")",!1),R=it("functionCall"),I=it("boolean"),D=ut("true",!1),M=ut("false",!1),j=it("number"),P=lt([["0","9"]],!1,!1),k=it("string"),U=ut("'",!1),W=lt(["'"],!0,!1),$=ut('"',!1),B=lt(['"'],!0,!1),G=it("array"),V=it("dict"),z=ut("{",!1),Z=ut("}",!1),q=it("function-ref"),X=ut("#",!1),J=lt([["a","z"],["A","Z"],"$","_"],!1,!1),K=lt([["a","z"],["A","Z"],"$","_",["0","9"],"_"],!1,!1),Q=it("symbol"),Y=it("whitespaces"),tt=lt([" ","\t","\n","\r"],!1,!1),et=0,rt=[{line:1,column:1}],nt=0,at=[],ot=0;if("startRule"in r){if(!(r.startRule in c))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=c[r.startRule]}function ut(t,e){return{type:"literal",text:t,ignoreCase:e}}function lt(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function it(t){return{type:"other",description:t}}function ct(t){var r,n=rt[t];if(n)return n;for(r=t-1;!rt[r];)r--;for(n={line:(n=rt[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return rt[t]=n,n}function st(t,e){var r=ct(t),n=ct(e);return{source:i,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function ht(t){et<nt||(et>nt&&(nt=et,at=[]),at.push(t))}function dt(){var t,e;return t=et,yt(),(e=ft())!==l?(yt(),t=e):(et=t,t=l),t}function ft(){var t,r,n,a,o,u,i;if(t=et,r=function(){var t;t=function(){var t,r,n,a,o,u,i,c;if(ot++,t=et,r=function(){var t,r,n,a,o,u;ot++,t=et,35===e.charCodeAt(et)?(r="#",et++):(r=l,0===ot&&ht(X));if(r!==l){if(n=[],a=et,o=[],b.test(e.charAt(et))?(u=e.charAt(et),et++):(u=l,0===ot&&ht(J)),u!==l)for(;u!==l;)o.push(u),b.test(e.charAt(et))?(u=e.charAt(et),et++):(u=l,0===ot&&ht(J));else o=l;for(o!==l?(58===e.charCodeAt(et)?(u=h,et++):(u=l,0===ot&&ht(x)),u!==l?a=o:(et=a,a=l)):(et=a,a=l);a!==l;){if(n.push(a),a=et,o=[],b.test(e.charAt(et))?(u=e.charAt(et),et++):(u=l,0===ot&&ht(J)),u!==l)for(;u!==l;)o.push(u),b.test(e.charAt(et))?(u=e.charAt(et),et++):(u=l,0===ot&&ht(J));else o=l;o!==l?(58===e.charCodeAt(et)?(u=h,et++):(u=l,0===ot&&ht(x)),u!==l?a=o:(et=a,a=l)):(et=a,a=l)}if(b.test(e.charAt(et))?(a=e.charAt(et),et++):(a=l,0===ot&&ht(J)),a!==l){for(o=[],T.test(e.charAt(et))?(u=e.charAt(et),et++):(u=l,0===ot&&ht(K));u!==l;)o.push(u),T.test(e.charAt(et))?(u=e.charAt(et),et++):(u=l,0===ot&&ht(K));i=a,c=o,t={type:"function",module:n.map((t=>t.join(""))),value:i+c.join("")}}else et=t,t=l}else et=t,t=l;var i,c;ot--,t===l&&(r=l,0===ot&&ht(q));return t}(),r!==l)if(40===e.charCodeAt(et)?(n="(",et++):(n=l,0===ot&&ht(L)),n!==l){for(yt(),a=et,(o=ft())!==l?(u=yt(),a=o):(et=a,a=l),a===l&&(a=null),o=[],u=et,44===e.charCodeAt(et)?(i=f,et++):(i=l,0===ot&&ht(_)),i!==l?(yt(),(c=ft())!==l?(yt(),u=c):(et=u,u=l)):(et=u,u=l);u!==l;)o.push(u),u=et,44===e.charCodeAt(et)?(i=f,et++):(i=l,0===ot&&ht(_)),i!==l?(yt(),(c=ft())!==l?(yt(),u=c):(et=u,u=l)):(et=u,u=l);41===e.charCodeAt(et)?(u=")",et++):(u=l,0===ot&&ht(H)),u!==l?(d=o,t={type:"call",value:r,args:null==(s=a)?[]:[s].concat(d)}):(et=t,t=l)}else et=t,t=l;else et=t,t=l;var s,d;ot--,t===l&&(r=l,0===ot&&ht(R));return t}(),t===l&&(t=function(){var t;t=function(){var t,r,n,a,o,u;ot++,t=et,r=[],A.test(e.charAt(et))?(n=e.charAt(et),et++):(n=l,0===ot&&ht(P));if(n!==l)for(;n!==l;)r.push(n),A.test(e.charAt(et))?(n=e.charAt(et),et++):(n=l,0===ot&&ht(P));else r=l;if(r!==l){if(n=et,46===e.charCodeAt(et)?(a=".",et++):(a=l,0===ot&&ht(N)),a!==l){for(o=[],A.test(e.charAt(et))?(u=e.charAt(et),et++):(u=l,0===ot&&ht(P));u!==l;)o.push(u),A.test(e.charAt(et))?(u=e.charAt(et),et++):(u=l,0===ot&&ht(P));n=o}else et=n,n=l;n===l&&(n=null),i=r,t=null==(c=n)?{type:"literal",value:parseInt(i.join(""))}:{type:"literal",value:parseFloat(i.join("")+"."+c.join(""))}}else et=t,t=l;var i,c;ot--,t===l&&(r=l,0===ot&&ht(j));return t}(),t===l&&(t=function(){var t,r;ot++,t=et,e.substr(et,4)===p?(r=p,et+=4):(r=l,0===ot&&ht(D));r!==l&&(r={type:"literal",value:!0});(t=r)===l&&(t=et,e.substr(et,5)===v?(r=v,et+=5):(r=l,0===ot&&ht(M)),r!==l&&(r={type:"literal",value:!1}),t=r);ot--,t===l&&(r=l,0===ot&&ht(I));return t}(),t===l&&(t=bt())===l&&(t=function(){var t,r,n,a,o,u,i;ot++,t=et,91===e.charCodeAt(et)?(r="[",et++):(r=l,0===ot&&ht(w));if(r!==l){for(yt(),(n=ft())===l&&(n=null),yt(),a=[],o=et,44===e.charCodeAt(et)?(u=f,et++):(u=l,0===ot&&ht(_)),u!==l?(yt(),(i=ft())!==l?(yt(),o=i):(et=o,o=l)):(et=o,o=l);o!==l;)a.push(o),o=et,44===e.charCodeAt(et)?(u=f,et++):(u=l,0===ot&&ht(_)),u!==l?(yt(),(i=ft())!==l?(yt(),o=i):(et=o,o=l)):(et=o,o=l);93===e.charCodeAt(et)?(o="]",et++):(o=l,0===ot&&ht(O)),o!==l?(s=a,t={type:"array",value:null==(c=n)?[]:[c].concat(s)}):(et=t,t=l)}else et=t,t=l;var c,s;ot--,t===l&&(r=l,0===ot&&ht(G));return t}(),t===l&&(t=function(){var t,r,n,a,o,u,i,c,s,d,p;ot++,t=et,123===e.charCodeAt(et)?(r="{",et++):(r=l,0===ot&&ht(z));if(r!==l){for(yt(),n=et,(a=bt())!==l?(o=yt(),58===e.charCodeAt(et)?(u=h,et++):(u=l,0===ot&&ht(x)),u!==l?(i=yt(),(c=ft())!==l?n=[a,c]:(et=n,n=l)):(et=n,n=l)):(et=n,n=l),n===l&&(n=null),a=yt(),o=[],u=et,44===e.charCodeAt(et)?(i=f,et++):(i=l,0===ot&&ht(_)),i!==l?(c=yt(),(s=bt())!==l?(yt(),58===e.charCodeAt(et)?(d=h,et++):(d=l,0===ot&&ht(x)),d!==l?(yt(),(p=ft())!==l?(yt(),u=[s,p]):(et=u,u=l)):(et=u,u=l)):(et=u,u=l)):(et=u,u=l);u!==l;)o.push(u),u=et,44===e.charCodeAt(et)?(i=f,et++):(i=l,0===ot&&ht(_)),i!==l?(c=yt(),(s=bt())!==l?(yt(),58===e.charCodeAt(et)?(d=h,et++):(d=l,0===ot&&ht(x)),d!==l?(yt(),(p=ft())!==l?(yt(),u=[s,p]):(et=u,u=l)):(et=u,u=l)):(et=u,u=l)):(et=u,u=l);125===e.charCodeAt(et)?(u="}",et++):(u=l,0===ot&&ht(Z)),u!==l?(A=o,m=[],null!==(v=n)&&m.push(v),m.push.apply(m,A),t={type:"dict",value:m}):(et=t,t=l)}else et=t,t=l;var v,A,m;ot--,t===l&&(r=l,0===ot&&ht(V));return t}(),t===l&&(t=bt()))));return t}(),t===l&&(t=Tt()));return t}(),r!==l){for(yt(),n=[],a=et,(o=pt())===l&&(o=vt())===l&&(o=At())===l&&(o=mt())===l&&(o=gt()),o!==l?(yt(),a=o):(et=a,a=l);a!==l;)n.push(a),a=et,(o=pt())===l&&(o=vt())===l&&(o=At())===l&&(o=mt())===l&&(o=gt()),o!==l?(yt(),a=o):(et=a,a=l);u=r,t=0===(i=n).length?u:{type:"nav",from:u,to:i}}else et=t,t=l;return t}function pt(){var t,r,n,a,o;return t=et,63===e.charCodeAt(et)?(r="?",et++):(r=l,0===ot&&ht(C)),r!==l?(yt(),(n=ft())===l&&(n=null),yt(),58===e.charCodeAt(et)?(a=h,et++):(a=l,0===ot&&ht(x)),a!==l?(yt(),(o=ft())!==l?t={type:"cond",ifTrue:n,ifFalse:o}:(et=t,t=l)):(et=t,t=l)):(et=t,t=l),t}function vt(){var t,r,n;return t=et,e.substr(et,2)===d?(r=d,et+=2):(r=l,0===ot&&ht(E)),r!==l?(yt(),(n=Tt())!==l?t={type:"dot",ns:!0,value:n.value}:(et=t,t=l)):(et=t,t=l),t}function At(){var t,r,n;return t=et,46===e.charCodeAt(et)?(r=".",et++):(r=l,0===ot&&ht(N)),r!==l?(yt(),(n=Tt())!==l?t={type:"dot",ns:!1,value:n.value}:(et=t,t=l)):(et=t,t=l),t}function mt(){var t,r,n,a,o;return ot++,t=et,e.substr(et,2)===d?(r=d,et+=2):(r=l,0===ot&&ht(E)),r===l&&(r=null),91===e.charCodeAt(et)?(n="[",et++):(n=l,0===ot&&ht(w)),n!==l?(yt(),(a=ft())!==l?(yt(),93===e.charCodeAt(et)?(o="]",et++):(o=l,0===ot&&ht(O)),o!==l?t={type:"sub",ns:null!==r,value:a}:(et=t,t=l)):(et=t,t=l)):(et=t,t=l),ot--,t===l&&(r=l,0===ot&&ht(F)),t}function gt(){var t,r,n,a,o,u,i,c,s,h;if(ot++,t=et,e.substr(et,2)===d?(r=d,et+=2):(r=l,0===ot&&ht(E)),r===l&&(r=null),40===e.charCodeAt(et)?(n="(",et++):(n=l,0===ot&&ht(L)),n!==l){for(yt(),a=et,(o=ft())!==l?(u=yt(),a=o):(et=a,a=l),a===l&&(a=null),o=[],u=et,44===e.charCodeAt(et)?(i=f,et++):(i=l,0===ot&&ht(_)),i!==l?(yt(),(c=ft())!==l?(yt(),u=c):(et=u,u=l)):(et=u,u=l);u!==l;)o.push(u),u=et,44===e.charCodeAt(et)?(i=f,et++):(i=l,0===ot&&ht(_)),i!==l?(yt(),(c=ft())!==l?(yt(),u=c):(et=u,u=l)):(et=u,u=l);41===e.charCodeAt(et)?(u=")",et++):(u=l,0===ot&&ht(H)),u!==l?(h=o,t={type:"method",ns:null!==r,value:null==(s=a)?[]:[s].concat(h)}):(et=t,t=l)}else et=t,t=l;return ot--,t===l&&(r=l,0===ot&&ht(S)),t}function bt(){var t,r,n,a;if(ot++,t=et,39===e.charCodeAt(et)?(r="'",et++):(r=l,0===ot&&ht(U)),r!==l){for(n=[],m.test(e.charAt(et))?(a=e.charAt(et),et++):(a=l,0===ot&&ht(W));a!==l;)n.push(a),m.test(e.charAt(et))?(a=e.charAt(et),et++):(a=l,0===ot&&ht(W));39===e.charCodeAt(et)?(a="'",et++):(a=l,0===ot&&ht(U)),a!==l?t=function(t){return{type:"literal",value:t.join("")}}(n):(et=t,t=l)}else et=t,t=l;if(t===l)if(t=et,34===e.charCodeAt(et)?(r='"',et++):(r=l,0===ot&&ht($)),r!==l){for(n=[],g.test(e.charAt(et))?(a=e.charAt(et),et++):(a=l,0===ot&&ht(B));a!==l;)n.push(a),g.test(e.charAt(et))?(a=e.charAt(et),et++):(a=l,0===ot&&ht(B));34===e.charCodeAt(et)?(a='"',et++):(a=l,0===ot&&ht($)),a!==l?t={type:"literal",value:v1.join("")}:(et=t,t=l)}else et=t,t=l;return ot--,t===l&&(r=l,0===ot&&ht(k)),t}function Tt(){var t,r,n,a;if(ot++,t=et,b.test(e.charAt(et))?(r=e.charAt(et),et++):(r=l,0===ot&&ht(J)),r!==l){for(n=[],T.test(e.charAt(et))?(a=e.charAt(et),et++):(a=l,0===ot&&ht(K));a!==l;)n.push(a),T.test(e.charAt(et))?(a=e.charAt(et),et++):(a=l,0===ot&&ht(K));t={type:"symbol",value:r+n.join("")}}else et=t,t=l;return ot--,t===l&&(r=l,0===ot&&ht(Q)),t}function yt(){var t,r;for(ot++,t=[],y.test(e.charAt(et))?(r=e.charAt(et),et++):(r=l,0===ot&&ht(tt));r!==l;)t.push(r),y.test(e.charAt(et))?(r=e.charAt(et),et++):(r=l,0===ot&&ht(tt));return ot--,r=l,0===ot&&ht(Y),t}if((n=s())!==l&&et===e.length)return n;throw n!==l&&et<e.length&&ht({type:"end"}),a=at,o=nt<e.length?e.charAt(nt):null,u=nt<e.length?st(nt,nt+1):st(nt,nt),new t(t.buildMessage(a,o),a,o,u)}function n(t,e,r,a){var o=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(o,n.prototype),o.expected=e,o.found=r,o.location=a,o.name="SyntaxError",o}function a(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}function o(t,e){var r,a,o,u,l={},i=(e=void 0!==e?e:{}).grammarSource,c={Root:D},s=D,h="{{{",d="}}}",f="{{",p="}}",v="{",A="}",m=/^[^{}]/,g=_("{{{",!1),b=_("}}}",!1),T=_("{{",!1),y=_("}}",!1),C={type:"class",parts:["{","}"],inverted:!0,ignoreCase:!1},x=_("{",!1),E=_("}",!1),N=_("\\",!1),F=0,w=[{line:1,column:1}],O=0,S=[],L=0;if("startRule"in e){if(!(e.startRule in c))throw new Error("Can't start parsing from rule \""+e.startRule+'".');s=c[e.startRule]}function _(t,e){return{type:"literal",text:t,ignoreCase:e}}function H(e){var r,n=w[e];if(n)return n;for(r=e-1;!w[r];)r--;for(n={line:(n=w[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return w[e]=n,n}function R(t,e){var r=H(t),n=H(e);return{source:i,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function I(t){F<O||(F>O&&(O=F,S=[]),S.push(t))}function D(){var t,e;for(t=[],e=M();e!==l;)t.push(e),e=M();return t}function M(){var e,r,n,a,o;return e=F,r=F,n=function(){var e;t.substr(F,3)===h?(e=h,F+=3):(e=l,0===L&&I(g));return e}(),n!==l&&(a=j())!==l?(o=function(){var e;t.substr(F,3)===d?(e=d,F+=3):(e=l,0===L&&I(b));return e}(),o!==l?r=a:(F=r,r=l)):(F=r,r=l),r!==l&&(r={t:"he",v:r}),(e=r)===l&&(e=F,r=F,n=function(){var e;t.substr(F,2)===f?(e=f,F+=2):(e=l,0===L&&I(T));return e}(),n!==l&&(a=j())!==l?(o=function(){var e;t.substr(F,2)===p?(e=p,F+=2):(e=l,0===L&&I(y));return e}(),o!==l?r=a:(F=r,r=l)):(F=r,r=l),r!==l&&(r=function(t){return{t:"te",v:t}}(r)),(e=r)===l&&(e=F,(r=j())!==l&&(r=function(t){return{t:"t",v:t}}(r)),e=r)),e}function j(){var e,r,n,a,o;if(F,e=[],(r=P())===l&&(r=k())===l&&(r=F,m.test(t.charAt(F))?(n=t.charAt(F),F++):(n=l,0===L&&I(C)),n!==l?r=n:(F=r,r=l),r===l&&(r=F,123===t.charCodeAt(F)?(n=v,F++):(n=l,0===L&&I(x)),n!==l?(a=F,L++,123===t.charCodeAt(F)?(o=v,F++):(o=l,0===L&&I(x)),L--,o===l?a=void 0:(F=a,a=l),a!==l?r=n:(F=r,r=l)):(F=r,r=l),r===l&&(r=F,125===t.charCodeAt(F)?(n=A,F++):(n=l,0===L&&I(E)),n!==l?(a=F,L++,125===t.charCodeAt(F)?(o=A,F++):(o=l,0===L&&I(E)),L--,o===l?a=void 0:(F=a,a=l),a!==l?r=n:(F=r,r=l)):(F=r,r=l)))),r!==l)for(;r!==l;)e.push(r),(r=P())===l&&(r=k())===l&&(r=F,m.test(t.charAt(F))?(n=t.charAt(F),F++):(n=l,0===L&&I(C)),n!==l?r=n:(F=r,r=l),r===l&&(r=F,123===t.charCodeAt(F)?(n=v,F++):(n=l,0===L&&I(x)),n!==l?(a=F,L++,123===t.charCodeAt(F)?(o=v,F++):(o=l,0===L&&I(x)),L--,o===l?a=void 0:(F=a,a=l),a!==l?r=n:(F=r,r=l)):(F=r,r=l),r===l&&(r=F,125===t.charCodeAt(F)?(n=A,F++):(n=l,0===L&&I(E)),n!==l?(a=F,L++,125===t.charCodeAt(F)?(o=A,F++):(o=l,0===L&&I(E)),L--,o===l?a=void 0:(F=a,a=l),a!==l?r=n:(F=r,r=l)):(F=r,r=l))));else e=l;return e!==l&&(e=e.join("")),e}function P(){var e,r,n;return e=F,92===t.charCodeAt(F)?(r="\\",F++):(r=l,0===L&&I(N)),r!==l?(123===t.charCodeAt(F)?(n=v,F++):(n=l,0===L&&I(x)),n!==l?e=n:(F=e,e=l)):(F=e,e=l),e}function k(){var e,r,n;return e=F,92===t.charCodeAt(F)?(r="\\",F++):(r=l,0===L&&I(N)),r!==l?(125===t.charCodeAt(F)?(n=A,F++):(n=l,0===L&&I(E)),n!==l?e=n:(F=e,e=l)):(F=e,e=l),e}if((r=s())!==l&&F===t.length)return r;throw r!==l&&F<t.length&&I({type:"end"}),a=S,o=O<t.length?t.charAt(O):null,u=O<t.length?R(O,O+1):R(O,O),new n(n.buildMessage(a,o),a,o,u)}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.prototype.format=function(t){var r="Error: "+this.message;if(this.location){var n,a=null;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){a=t[n].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,u=this.location.source+":"+o.line+":"+o.column;if(a){var l=this.location.end,i=e("",o.line.toString().length," "),c=a[o.line-1],s=(o.line===l.line?l.column:c.length+1)-o.column||1;r+="\n --\x3e "+u+"\n"+i+" |\n"+o.line+" | "+c+"\n"+i+" | "+e("",o.column-1," ")+e("",s,"^")}else r+="\n at "+u}return r},t.buildMessage=function(t,e){var r={literal:function(t){return'"'+a(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function a(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function u(t){return r[t.type](t)}return"Expected "+function(t){var e,r,n=t.map(u);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+a(t)+'"':"end of input"}(e)+" found."},function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(n,Error),n.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<t.length;r++)if(t[r].source===this.location.source){n=t[r].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,u=this.location.source+":"+o.line+":"+o.column;if(n){var l=this.location.end,i=a("",o.line.toString().length," "),c=n[o.line-1],s=(o.line===l.line?l.column:c.length+1)-o.column||1;e+="\n --\x3e "+u+"\n"+i+" |\n"+o.line+" | "+c+"\n"+i+" | "+a("",o.column-1," ")+a("",s,"^")}else e+="\n at "+u}return e},n.buildMessage=function(t,e){var r={literal:function(t){return'"'+a(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function a(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function u(t){return r[t.type](t)}return"Expected "+function(t){var e,r,n=t.map(u);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+a(t)+'"':"end of input"}(e)+" found."};class u{constructor(t,e){this.dataStack=t,this.functions=e}call(t){const e=t.value,r=e.module.reduce(((t,e)=>t[e]),this.functions),n=t.args.map((t=>this.visit(t)));return r[e.value].call(this,n)}nav(t){const e=[this.visit(t.from)];for(let r=0;r!==t.to.length;++r){const n=this.visit(t.to[r],e[r],e[r-1]);if(0===n.length)return e[e.length-1];e.push(n[0])}return e[e.length-1]}literal(t){return t.value}symbol(t){if("self"===t.value)return this.dataStack[this.dataStack.length-1];for(let e=this.dataStack.length;0!==e;--e){const r=this.dataStack[e-1];if(r.hasOwnProperty(t.value))return r[t.value]}}cond(t,e){return e?null===t.ifTrue?e:this.visit(t.ifTrue):this.visit(t.ifFalse)}dict(t){return t.value.map((t=>[t[0].value,this.visit(t[1])]))}array(t){return t.value.map((t=>this.visit(t)))}dot(t,e){return t.ns&&null==e?[]:[e[t.value]]}sub(t,e){return t.ns&&null==e?[]:[e[this.visit(t.value)]]}method(t,e,r){if(t.ns&&null==e)return[];const n=t.value.map((t=>this.visit(t)));return[e.call(r,n)]}visit(t,...e){return this[t.type](t,...e)}}class l{constructor(t){this.functions=t||{}}parse(t){return r(t)}evaluateAst(t,e){return new u(e,this.functions).visit(t)}evaluate(t,...e){return this.evaluateAst(this.parse(t),e)}}class i{constructor(t){this.evaluator=t}parse(t){return o(t).map((t=>"t"===t.t?t:{t:t.t,v:this.evaluator.parse(t.v)}))}evaluateAst(t,e){return t.map((t=>"t"===t.t?t:{t:"te"===t.t?"t":"h",v:this.evaluator.evaluateAst(t.v,e)}))}evaluate(t,...e){return this.evaluateAst(this.parse(t),e)}}function c(t,e,r,n,a){const o=t[e.dataset.bindMutator]||t[e.dataset.bindProvide];o?o(e,r,n,a):e.value=r}class s{extractors;mutators;valueHoldersSelector;ignoredChildrenSelector;constructor({extractors:t,mutators:e,ignoredChildrenSelector:r,valueHoldersSelector:n}){this.extractors=t||{},this.mutators=e||{},this.valueHoldersSelector=n||"input[name], select[name], textarea[name]",this.ignoredChildrenSelector=r||".hidden"}apply(t,e){for(let r in e){if(!e.hasOwnProperty(r))continue;const n=t.querySelector(`[name='${r}']`);c(this.mutators,n,e[r],r,e)}}values(t){return Array.from(t.querySelectorAll(this.valueHoldersSelector)).filter((t=>{if("never"===t.dataset.bindInclude)return!1;return!("always"!==t.dataset.bindInclude&&null!==t.closest(this.ignoredChildrenSelector))})).reduce(((t,e)=>function(t,e,r){const n=e.split(".").map((t=>t.match(/^[0-9]+$/)?+t:t));let a=t,o=null;for(let e=0;;++e){const u=n[e],l=n[e-1];if(Number.isInteger(u)&&!Array.isArray(a)&&(null!==o?o[l]=a=[]:t=a=[]),e===n.length-1)return a[u]=void 0!==r?r:a.hasOwnProperty(u)?a[u]:null,t;void 0===a[u]&&(a[u]={}),o=a,a=a[u]}}(t,e.getAttribute("name"),function(t,e){const r=t[e.dataset.bindExtractor]||t[e.dataset.bindProvide];if(r)return r(e);if("radio"===e.getAttribute("type")){if(!e.checked)return;return"boolean"===e.dataset.bindType?"true"===e.value:e.value}return"checkbox"===e.getAttribute("type")?e.checked:"boolean"===e.dataset.bindType?e.value?"true"===e.value:null:e.value||null}(this.extractors,e))),{})}}const h={fragmentFromNodes(t,...e){const r=new DocumentFragment;for(let n=0;n!==e.length;++n){const a=e[n];r.appendChild(t?a.cloneNode(!0):a)}return r},fragmentFromHtml(...t){const e=document.createElement("div");return e.innerHTML=t.join(""),h.fragmentFromNodes(!1,...e.childNodes)},html(...t){var e=document.createElement("root");return e.appendChild(h.fragmentFromNodes(!0,...t)),e.innerHTML},addSuccessors(t,e){const r=Array.from(e);let n=t.nextSibling;for(let e=0;e!==r.length;++e){const a=r[e];t.parentNode.insertBefore(a,n),n=a.nextSibling}},meta(t){const e=document.querySelector(`meta[name='${t}']`);return null===e?null:e.getAttribute("content")},context:()=>h.meta("context")||"/",lang:t=>(document.documentElement.getAttribute("lang")||t||"it").toLowerCase()};function d(t){return t.nodeType===Node.TEXT_NODE?-1!==t.nodeValue.indexOf("{{")&&-1!==t.nodeValue.indexOf("}}")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT:Array.from(t.attributes).some((t=>t.name.startsWith("data-tpl-")))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}class f{evaluator;textNodeEvaluator;node;static fromHtml(t,e,r){return new f({node:h.fragmentFromHtml(t),evaluator:e,textNodeEvaluator:r})}static fromNodes(t,e,r){return new f({node:h.fragmentFromNodes(!0,...t),evaluator:e,textNodeEvaluator:r})}static fromNode(t,e,r){return new f({node:h.fragmentFromNodes(!0,t),evaluator:e,textNodeEvaluator:r})}static render(t,...e){return new f(t).render(...e)}static renderTo(t,e,...r){return new f(t).renderTo(e,...r)}static appendTo(t,e,...r){return new f(t).appendTo(e,...r)}constructor({node:t,evaluator:e,textNodeEvaluator:r}){this.evaluator=e,this.textNodeEvaluator=r,this.node=t}withNode(t){return f.fromNode(t,this.evaluator,this.textNodeEvaluator)}render(...t){const e=this.node.cloneNode(!0),r=document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,d),n=[];let a;for(;null!==(a=r.nextNode());){if(a.nodeType===Node.TEXT_NODE){this.handleTextNode(a,n,...t);continue}a.hasAttribute("data-tpl-if")&&this.handleAttributeIf(a,n,...t),a.hasAttribute("data-tpl-with")&&this.handleAttributeWith(a,n,...t),a.hasAttribute("data-tpl-each")&&this.handleAttributeEach(a,n,...t),a.hasAttribute("data-tpl-text")&&this.handleAttributeText(a,n,...t),a.hasAttribute("data-tpl-html")&&this.handleAttributeHtml(a,n,...t),a.hasAttribute("data-tpl-remove")&&this.handleAttributeRemove(a,n,...t);const e="data-tpl-";Array.from(a.attributes).filter((({name:t})=>t.startsWith(e))).forEach((({name:r})=>{const n=r.substring(e.length),o=a.getAttribute(r),u=this.evaluator.evaluate(o,...t);a.setAttribute(n,u),a.removeAttribute(r)}))}return n.forEach((t=>t.remove())),e}renderTo(t,...e){const r=this.render(...e);t.innerHTML="",t.appendChild(r)}appendTo(t,...e){const r=this.render(...e);t.appendChild(r)}handleAttributeIf(t,e,...r){const n=this.evaluator.evaluate(t.dataset.tplIf,...r);t.removeAttribute("data-tpl-if"),n||(t.innerHTML="",e.push(t))}handleAttributeWith(t,e,...r){const n=this.evaluator.evaluate(t.dataset.tplWith,...r);t.removeAttribute("data-tpl-with");const a=t.dataset.tplVar;t.removeAttribute("data-tpl-var");const o=this.withNode(t).render(...r,a?{[a]:n}:n);t.innerHTML="",h.addSuccessors(t,[o]),e.push(t)}handleAttributeEach(t,e,...r){const n=this.evaluator.evaluate(t.dataset.tplEach,...r);t.removeAttribute("data-tpl-each");const a=t.dataset.tplVar;t.removeAttribute("data-tpl-var");const o=n.map((e=>this.withNode(t).render(...r,a?{[a]:e}:e)));t.innerHTML="",h.addSuccessors(t,o),e.push(t)}handleAttributeRemove(t,e,...r){const n=t.dataset.tplRemove.toLowerCase();switch(t.removeAttribute("data-tpl-remove"),n){case"tag":h.addSuccessors(t,t.childNodes),e.push(t);break;case"body":t.innerHTML="";break;case"all":e.push(t)}}handleAttributeText(t,e,...r){const n=this.evaluator.evaluate(t.dataset.tplText,...r);t.removeAttribute("data-tpl-text"),t.innerHTML="",t.textContent=n}handleAttributeHtml(t,e,...r){const n=this.evaluator.evaluate(t.dataset.tplHtml,...r);t.removeAttribute("data-tpl-html"),t.innerHTML=n}handleTextNode(t,e,...r){const n=this.textNodeEvaluator.evaluate(t.nodeValue,...r).map((t=>"t"===t.t?document.createTextNode(t.v):h.fragmentFromHtml(t.v)));h.addSuccessors(t,n),e.push(t)}}const p={sleep:t=>new Promise((e=>setTimeout(e,t))),DEBOUNCE_DEFAULT:0,DEBOUNCE_IMMEDIATE:1,debounce(t,e,r){let n=null,a=[],o=0,u=r||p.DEBOUNCE_DEFAULT;const l=()=>{const r=(new Date).getTime()-o;t>r?n=setTimeout(l,t-r):(n=null,u!==p.DEBOUNCE_IMMEDIATE&&e(...a),null===n&&(a=[]))};return function(){a=arguments,o=(new Date).getTime(),null===n&&(n=setTimeout(l,t),u===p.DEBOUNCE_IMMEDIATE&&e(...a))}},THROTTLE_DEFAULT:0,THROTTLE_NO_LEADING:1,THROTTLE_NO_TRAILING:2,throttle(t,e,r){let n=null,a=[],o=0,u=r||p.THROTTLE_DEFAULT;const l=()=>{o=u&p.THROTTLE_NO_LEADING?0:(new Date).getTime(),n=null,e(...a),null===n&&(a=[])};return function(){const r=(new Date).getTime();!o&&u&p.THROTTLE_NO_LEADING&&(o=r);const i=t-(r-o);a=arguments,i<=0||i>t?(null!==n&&(clearTimeout(n),n=null),o=r,e(...a),null===n&&(a=[])):null!==n||u&p.THROTTLE_NO_TRAILING||(n=setTimeout(l,i))}}};export{s as Bindings,l as ExpressionEvaluator,f as Template,i as TextNodeExpressionEvaluator,h as dom,p as timing};
//# sourceMappingURL=ftl.min.mjs.map
